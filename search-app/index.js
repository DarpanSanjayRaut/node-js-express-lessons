const express = require('express')
const app = express()
const mongoose = require('mongoose')
const bodyParser = require('body-parser');
const jsonParser = bodyParser.json()
var stringSimilarity = require('string-similarity');
const cors = require('cors')
app.use(cors())
app.use(express.static(__dirname + '/assets'));
app.use(jsonParser)
const EMP = require('./model/emp')

var cities = ["ABDASA","Abohar","Abu Dhabi","Achampet","Adilabad","ADIPUR","Agartala","Agra","Ahmedabad","AHMEDB","Ahmednagar","Aizawl","Ajman","Ajmer","Akola","Alappuzha","Alibaug","Aligarh","Allahabad","Alleppey","Almora","Along","Aluva","Alwar","AMALSAD","Amareli","AMBAJI","Ambala","Ambassa","Ambedkar Nagar","Ambikapur","Ambur","Amravati","Amreli","Amritsar","Anand","Anantapur","Anantnag","Andman and Nicobar","Angul","ANJAR","Anjaw","Ankleshwar","Ankola","Anuppur","Araria","Ariyalur","Asansol","Ashoknagar","Auraiya","Aurangabad","Azamgarh","Badaun","Baddi","Bagalkote","Bageshwar","Baghpat","Bahadurgarh","Bahadurpura","Bahraich","Baikunthpur","BAJWA","Baksa","Balaghat","Balasore","Baleswar","Ballia","Balrampur","Banaskantha","Banaskhantha","Banda","Bandipore","Banka","Bankura","Banswara","Barabanki","Baramati","Baramulla","Baran","Bardhaman","BARDOLI","Bareilly","Bargarh","Barmer","Barnala","Barpeta","Barwani","Bastar","Basti","Bathinda","BAVALA","Beawar","Beed","Begusarai","Behrampur","Belgaum","Bellary","Bengaluru","BETROJ","Bettiah","Betul","Bhabua","BHACHAU","Bhadrak","Bhagalpur","Bhandara","Bharatpur","Bharuch","Bhatinda","Bhavnagar","BHILAD","Bhilai","Bhilwara","Bhind","Bhiwadi","Bhiwani","Bhojpur","Bhopal","Bhubaneswar","Bhuj","Bhuvaneshwar","Bidar","Bijapur","Bijnor","Bikaner","Bilaspur","BILIMORA","Birbhum","Bishnupur","Bokaro","Bolangir","Bomdila","Bongaigaon","Borsad","Boudh","Budgam","Bulandshahr","Buldhana","Bundi","Burdwan","Burhanpur","Buxar","Cachar","Chamarajanagar","Chamba","Chamoli","Champawat","Champhai","CHAND KHEDA","Chandauli","Chandel","Chandigarh","Chandrapur","Changlang","Chapra","Chatra","Chennai","Chhatarpur","Chhindwara","Chidambaram","CHIKHLI (GUJ.)","Chikkaballapur","Chikkamagaluru","Chinnamiram","Chirang","Chitradurga","Chitrakoot","Chittoor","Chittorgarh","CHOTILA","Churachandpur","Churu","Coimbatore","Cooch Behar","Cuddalore","Cuttack","Daang","Dadra & nagar Haveli","Dahod","Dakshin Dinajpur","Dakshina Kannada","Daman","Daman & Diu","Damanjodi","Damoh","Dantewada","Daporijo","Darbhanga","Darjeeling","Darrang","Datia","Dausa","Davanagere","DEESA","Dehradun","Delhi","Deogarh","Deoghar","Deoria","Dewas","Dhalai","Dhamtari","Dhanbad","DHANDHUKA","DHANGARDHA","Dhar","Dharmapuri","Dharwad","Dhemaji","Dhenkanal","Dholpur","DHORAJI","Dhubri","Dhule","Dibang Valley","Dibrugarh","Dimapur","Dindigul","Dindori","Dispur","Diu","Doda","Dubai","Dumka","Dungarpur","Durg","Durgapur","DWARKA","East Garo Hills","East Godavari","East Kameng","East Khasi Hills","East Siang","East Singhbhum","Ernakulam","Erode","Etah","Etawah","Faizabad","Faridabad","Faridkot","Farrukhabad","Fatehabad","Fatehgarh Sahib","Fatehpur","Fazilka","Ferozepur","Firozabad","Firozpur","Fujairah","Gadag","Gadchiroli","Gadwal","Gajapati","Ganderbal","GANDEVI","Gandhi Nagar","Gandhidham","Gandhinagar","Ganganagar","Gangtok","Ganjam","Garhwa","Gautam Buddha Nagar","Gaya","Geyzing","Ghaziabad","Ghazipur","Giridih","Goa","Goalpara","Godda","GODHRA","Golaghat","Gonda","Gondia","Gopal Ganj","Gorakhpur","Gorkakhpur","Gulbarga","Gumla","Guna","Guntur","Gurdaspur","Gurgaon","Guwahati","Gwalior","Hailakandi","Hajipur","Haldia","Haldwani","Halol","Hamirpur","Hanumangarh","Hapur","Harda","Hardoi","Haridwar","Hassan","Hathras","Haveri","Hazaribagh","Himat Nagar","Himatnagar","Hingoli","Hisar","Hooghly","Hoshangabad","Hoshiarpur","Hospet","Hosur","Howrah","Hubli","Hyderabad","Ibrahimpatnam","Ichalkaranji","IDAR","Idukki","Imphal East","Imphal West","Indore","Itanagar","Jabalpur","Jagadalpur","Jagatsinghpur","Jagdalpur","Jahanabad","Jaintia Hills","Jaipur","Jaisalmer","Jajapur","Jalandhar","Jalaun","Jalgaon","Jalna","Jalore","Jalpaiguri","JAMKANDORANA","Jammu","Jamnagar","Jamshedpur","Jamtara","Jamui","Janigir - Champa","Janjgir-Champa","Jashpur","Jaunpur","JETPUR","Jhabua","Jhajjar","Jhalawar","Jhansi","Jharkhand","Jharsuguda","Jhunjhunu","Jind","Jodhpur","Jorhat","Junagadh","Jyotiba Phule Nagar","Kabri Anglong","Kadapa","Kadi","Kailashahar","Kaithal","Kakinada","Kalahandi","Kalka","KALOL","KAMREJ","Kamrup Metropolitian","Kamrup Rural","Kanchipuram","Kandhamal","KANDLA","Kangra","Kanker","KANKREJ","Kannauj","Kannur","Kanpur","Kanpur Dehat","Kanpur Nagar","Kanyakumari","KAPADWANJ","Kapurthala","Karad","Karauli","Karbi Anglong","Kargil","Karim Ganj","Karimganj","Karimnagar","Karnal","Karur","Kasaragod","Kasganj","Kashipur","Kathua","Katihar","Katni","Kaushambi","Kawardha","Kendrapara","Kendujhar","Keonjhar","KESHOD","Khagaria","Khairatabad","KHAMBHAT","Khammam","Khandwa","Khanna","KHANPUR","Khapoli","Kharagpur","Khargone","Kheda","Khonsa","Khunti","Khurdha","Kinnaur","Kiphire","Kishanganj","Kishtwar","Kochi","Kodad","Kodagu","Koderma","Kohima","Kokrajhar","Kolar","Kolasib","Kolhapur","Kolkata","Kollam","Koppal","Koraput","Korba","Koriya","Kosi","Kota","Kottayam","Kozhikode","Krishna","Krishnagiri","Kulgam","Kullu","Kumbakonam","Kunnamkulam","Kupwara","Kurnool","Kurukshetra","Kurung Kumey","Kushinagar","Kutch","Lahul and Spiti","Lakhimpur","Lakhimpur Kheri","Lakhisarai","Lakshadweep","Lalitpur","Latehar","Latur","Lawngtlai","Leh","Lohardaga","Lohit","Lonavala","Longleng","Lower Dibang Valley","Lower Subansiri","Lucknow","Ludhiana","LUNAWADA","Lunglei","Madgaon","Madhepura","Madhubani","Madurai","Magadh","Mahabub Nagar","Mahamaya Nagar","Maharajganj","Mahasamund","Mahbubabad","Mahbubnagar","Mahendragarh","Mahisadal","Mahoba","MAHUVA","Mainpuri","Malabar","Malappuram","Malda","Malegaon","Malkangiri","Malout","Mamit","Mancherial","Mandi","Mandla","Mandsaur","MANDVI","Mandya","Mangalore","Mangan","Mansa","Margao","Margoa","Marigaon","Mathura","Mau","Mayiladuthurai","Mayurbhanj","Medak","Meerut","Mehadipatnum","Mehsana","Mewat","Midnapore East","Midnapore West","Mirzapur","Modasa","Modinagar","Moga","Mohali","Mokokchung","Mon","Monghyr","Moradabad","Morena","Morvi","Motihari","Muktsar","Mumbai","Mundra","Munger","Murshidabad","Muzaffarnagar","Muzaffarpur","Mysore","Nabarangpur","Nabha","Nadia","Nadiad","Nagaon","Nagapattinam","Nagarkurnool","Nagaur","Nagercoil","Nagpur","Nainital","NAKHTRANA","Nalanda","Nalbari","Nalgonda","NALIYA","Namakkal","Namchi","NANAPONDHA","Nanded","Nandurbar","NARANPAR","Narayanpur","Narmada","NARODA","Narsinghpur","Nashik","Navi Mumbai","Navsari","NawabGanj","Nawadah","Nawanshahr","Nayagarh","Neemuch","Nellore","Nilgiris","Nizamabad","Noida","North 24 Parganas","North Cachar Hills","Nuapada","Ongole","Osmanabad","Other","others1","Pakur","Palakkad","Palamu","PALANPUR","Palghar","Pali","Palwal","Panaji","Panch Mahals","Panchkula","Panchmahal","Panipat","Panjim","Panna","Papum Pare","Parbhani","Paschimpathri","Pasighat","Patan","Pathanamthitta","Pathankot","Patiala","Patna","Pauri Garhwal","PAVIJETPUR","Peowa","Perambalur","Peren","Phagwara","Phek","Pilibhit","Piparia","Pithoragarh","Pollachi","Ponda","Pondicherry","Pontashaib","Poonch","Porbandar","Prakasam","Pratapgarh","Proddattur","Pudukkottai","Pulwama","Pune","Puri","Purnia","Purulia","RADHANPUR","Rae Bareli","Raichur","Raigad","Raigarh","Raipur","Raisen","Rajahmundry","Rajgarh","Rajkot","Rajnandgaon","Rajouri","RAJPIPLA","Rajpura","Rajsamand","Ramanagara","Ramanathapuram","Ramban","Ramgarh","Rampur","RANAVAV PORBANDAR","Ranchi","Rangareddy","Rangia","RAPAR","Ras Al Khaimah","Ratlam","Ratnagiri","Raxaul","Rayagada","Reasi","Rewa","Rewari","Ri-Bhoi","Rishikesh","Rohtak","Rohtas","Roing","Roorkee","Ropar","Rourkela","Rudraprayag","Rudrapur","Rupaichhari","Rupnagar","Sabarkantha","Sagar","Saharanpur","Saharsa","Sahebganj","Saiha","Salem","Samastipur","Samba","Sambalpur","Sampla","SANAND","Sanga Reddy","Sangamner","Sangli","Sangrur","SANJAN","Sant Kabir Nagar","Sant Ravidas Nagar","SANTRAMPURA","Saran","Satara","Satna","Sawai Madhopur","SAYAN","Secunderabad","Sehore","Senapati","Seoni","Seppa","Seraikela Kharsawan","Serchhip","Shahdol","Shahjahanpur","Shahpura","Shajapur","Sharjah","Sheikhpura","Sheopur","Shilong","Shimla","Shimoga","Shivpuri","Shopian","Shravasti","Sibsagar","Siddharthnagar","Siddipet","Sidhi","Sikar","Silchar","Siliguri","SILVASA","SILVASSA","Simdega","Sindhudurg","Singur","Sirmaur","Sirohi","Sirsa","Siruguppa","Sitamarhi","Sitapur","Sivagangai","Siwan","Solan","Solapur","Somireddipalle","SOMNATH JUNAGADHA","Sonbhadra","Sonepat","Sonepur","Sonipat","Sonitpur","South 24 Parganas","South Garo Hills","South Goa","sri ganganagar","Srikakulam","Srinagar","Sriperumbudur","Sultanpur","Sundargarh","Supaul","Surat","SURENDERNAGAR","Surendra Nagar","Surendranagar","Surguja","Suryapet","Tadipatri","Tamenglong","Tandur","Tanjore","Tanuku","Tarn Taran","Tawang","Tehri Garhwal and Uttarkashi","Tezpur","Tezu","Thane","Thanjavur","Theni","Thiruvalla","Thiruvananthapuram","Thoothukudi","Thoubal","Thrissur","Tikamgarh","Tinsukia","Tirap","Tirhut","Tiruchirapalli","Tirunelveli","Tirupati","Tiruppur","Tirur","Tiruvallur","Tiruvannamalai","Tiruvarur","Tonk","Travancore","Tuensang","Tumkur","Udaipur","Udalguri","Udham Singh Nagar","Udhampur","Udupi and Uttara Kannada","UDWADA","Ujjain","Ukhrul","Umaria","UMBERGAON","Umm al-Quwain","Una","Unnao","Upper Dibang Valley","Upper Siang","Upper Subansiri","Uttar Dinajpur","Vadodara","Vaishali","VALLABH VIDYANAGAR","VALOD","Valsad","Vapi","Varanasi","Vellore","Veraval","Vidisha","VIJAPUR","Vijayawada","Viluppuram","VIRPUR","Virudhunagar","Visakhapatnam","Vishakapatnam","VISNAGAR","Vizianagaram","Vrindavan","Vyara","WAGHODIA","Warangal","Wardha","Washim","Wayanad","West Garo Hills","West Godavari","West Kameng","West Khasi Hills","West Siang","West Singhbhum","Wokha","Yadgir","Yamuna Nagar","Yavatmal","Yingkiong","Zirakpur","Ziro","Zunheboto"]
app.post('/searchAPI', (req, res)=>{
	console.log("REQUEST DATA")
	console.log(req.body)

	var matches = stringSimilarity.findBestMatch(req.body.searchText, cities);
	console.log(matches.bestMatch)
	res.send({status : "success", data : matches.bestMatch})
})




app.post('/save', async (req, res)=>{
	console.log("SAVE")
    const emp = new EMP({
        empname: req.body.empname,
        date: req.body.date,
        salary: req.body.salary
    })
    try {
        const savPost = await emp.save()
        return res.json(savPost)
    } catch (e) {
        return res.send({ status: 'failed', message: e })
    }
})
// CONNECT TO MONGODB
mongoose.connect(
    'mongodb://localhost:27017/new',
    { useNewUrlParser: true }, 
    () => console.log("Connected to database!")
)


app.listen(3000)